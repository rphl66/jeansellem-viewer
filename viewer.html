<!-- Conteneur -->
<div id="jeansellem-viewer" style="height:80vh; min-height:480px;"></div>

<!-- Lib depuis GitHub Pages -->
<script src="https://rphl66.github.io/jeansellem-viewer/pdfjs/webviewer.min.js"></script>

<script>
(() => {
  const params = new URLSearchParams(location.search);
  let pdfUrl = params.get('file');

  // Par défaut : utiliser le PDF hébergé sur GitHub (évite CORS)
  if (!pdfUrl) {
    pdfUrl = 'https://rphl66.github.io/jeansellem-viewer/1971-sandro-adriani.pdf';
  } else if (!/^https?:\/\//.test(pdfUrl) && !pdfUrl.startsWith('/')) {
    // Si on donne juste un nom de fichier → prendre la copie GitHub
    pdfUrl = 'https://rphl66.github.io/jeansellem-viewer/' + encodeURIComponent(pdfUrl);
  } else if (pdfUrl.startsWith('/s/')) {
    // Si on force Squarespace, rendre l’URL absolue
    pdfUrl = 'https://www.raphaelleonardlevy.com' + pdfUrl;
  }

  const options = {
    path: 'https://rphl66.github.io/jeansellem-viewer/pdfjs',
    licenseKey: 'WQbdx5KD5SbQkjFwosWR',       // clé GitHub
    initialDoc: pdfUrl,

    // CSS servi depuis GitHub (même origine que l’UI → pas d’erreur)
    css: 'https://rphl66.github.io/jeansellem-viewer/pdfjs/viewer.css',

    // Config exécutée dans l’iframe (GitHub)
    config: 'https://rphl66.github.io/jeansellem-viewer/pdfjs/config.js'
  };

  function initViewer() {
    WebViewer(options, document.getElementById('jeansellem-viewer'));
  }

  // Lazy init
  const mountEl = document.getElementById('jeansellem-viewer');
  if ('IntersectionObserver' in window) {
    const io = new IntersectionObserver(entries => {
      if (entries.some(e => e.isIntersecting)) {
        io.disconnect(); initViewer();
      }
    }, { rootMargin: '300px' });
    io.observe(mountEl);
  } else {
    initViewer();
  }
})();
</script>
