<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viewer</title>
  <style>
    html,body { height:100%; margin:0 }
    #viewer   { height:100vh }
  </style>
  <!-- ton skin (à la racine du repo) -->
  <link rel="stylesheet" href="viewer.css">
</head>
<body>
  <div id="viewer"></div>

  <!-- Lib WebViewer (selon ta capture, le fichier est à la racine) -->
  <script src="pdfjs/webviewer.min.js"></script>
  <script>
  (function(){
    // Choix du PDF via ?file=... sinon "sample.pdf"
    const params = new URLSearchParams(location.search);
    const file = params.get('file') || 'sample.pdf';

    WebViewer({
      path: 'pdfjs',  // dossier qui contient /ui/ et /core/
      licenseKey: 'WQbdx5KD5SbQkjFwosWR',
      initialDoc: file,
      // IMPORTANT : URL ABSOLUE pour que l'UI interne charge bien ton CSS
      css: 'https://rphl66.github.io/jeansellem-viewer/viewer.css?v=1'
      // ⚠️ NE PAS ajouter config.js ici (il cassait en cross-origin)
    }, document.getElementById('viewer')).then(instance => {
      const { UI, Core } = instance;
      const dv = Core.documentViewer;

      // petit helper : exécuter une action
      const run = (act) => {
        try {
          const page = dv.getCurrentPage?.() || 1;
          const max  = dv.getPageCount?.()  || 1;
          switch (act) {
            case 'zin':  UI.zoomIn?.(); break;
            case 'zout': UI.zoomOut?.(); break;
            case 'first': dv.setCurrentPage?.(1); break;
            case 'prev':  dv.setCurrentPage?.(Math.max(1, page - 1)); break;
            case 'next':  dv.setCurrentPage?.(Math.min(max, page + 1)); break;
            case 'last':  dv.setCurrentPage?.(max); break;
          }
        } catch(e){ console.warn('[viewer] act error:', act, e); }
      };

      // FitWidth + file d'attente avant "prêt"
      let ready = false, queue = [];
      dv.addEventListener('documentLoaded', () => {
        ready = true;
        try { UI.setFitMode?.(UI.FitMode.FitWidth); } catch(e){}
        while (queue.length) run(queue.shift());
      });

      // Pont postMessage : reçoit les commandes de la page Squarespace (parent)
      window.addEventListener('message', (evt) => {
        const allowed = new Set([
          'https://www.raphaelleonardlevy.com',
          'https://raphaelleonardlevy.com',
          'https://preview.squarespace.com' // utile en mode édition
        ]);
        if (!allowed.has(evt.origin)) return;

        const data = evt.data || {};
        if (data.type !== 'JSL_CMD') return;

        if (!ready) queue.push(data.act);
        else run(data.act);

        // accusé de réception (optionnel)
        evt.source?.postMessage({ type:'JSL_ACK', act:data.act }, evt.origin);
      });
    });
  })();
  </script>
</body>
</html>
