<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viewer</title>
  <style>
    html,body { height:100%; margin:0 }
    #viewer   { height:100vh }
  </style>
  <!-- ton skin (à la racine du repo) -->
  <link rel="stylesheet" href="viewer.css">
</head>
<body>
  <div id="viewer"></div>

  <!-- Lib WebViewer (selon ta capture, le fichier est à la racine) -->
  <script src="webviewer.min.js"></script>
<script>
(function(){
  const params = new URLSearchParams(location.search);
  const file = params.get('file') || 'sample.pdf';

  WebViewer({
    path: 'pdfjs',
    licenseKey: 'WQbdx5KD5SbQkjFwosWR',
    initialDoc: file,
    css: 'https://rphl66.github.io/jeansellem-viewer/viewer.css?v=5' // ← URL absolue (bump v si tu modifies le CSS)
  }, document.getElementById('viewer')).then(instance => {
    const { UI, Core } = instance;
    const dv = Core.documentViewer;

    // Exécuter une action
    const run = (act) => {
      try {
        const page = dv.getCurrentPage?.() || 1;
        const max  = dv.getPageCount?.()  || 1;
        switch (act) {
          case 'zin':  UI.zoomIn?.(); break;
          case 'zout': UI.zoomOut?.(); break;
          case 'first': dv.setCurrentPage?.(1); break;
          case 'prev':  dv.setCurrentPage?.(Math.max(1, page - 1)); break;
          case 'next':  dv.setCurrentPage?.(Math.min(max, page + 1)); break;
          case 'last':  dv.setCurrentPage?.(max); break;
        }
      } catch(e){ console.warn('[viewer] act error:', act, e); }
    };

    // FitWidth + file d’attente
    let ready = false, queue = [];
    dv.addEventListener('documentLoaded', () => {
      ready = true;
      try { UI.setFitMode?.(UI.FitMode.FitWidth); } catch(e){}
      while (queue.length) run(queue.shift());
    });

    // Pont postMessage (accepte éditeur/public : on ne filtre plus par origin)
    window.addEventListener('message', (evt) => {
      const data = evt.data || {};
      if (data.type !== 'JSL_CMD') return;

      // sécurité minimale : n’exécuter que nos 6 actions autorisées
      const allowedActs = new Set(['zin','zout','first','prev','next','last']);
      if (!allowedActs.has(data.act)) return;

      if (!ready) queue.push(data.act);
      else run(data.act);

      // ACK (facultatif)
      evt.source?.postMessage({ type:'JSL_ACK', act:data.act }, evt.origin);
    });

    // Fallback anti-barre (au cas où viewer.css ne charge pas)
    const killHeaderCSS = `
      #documentHeader, .Header, .Header *, [data-element="header"]{display:none!important;height:0!important;min-height:0!important;padding:0!important;border:0!important}
      [data-element="toolsHeader"],[data-element="toolsOverlay"],.toolsHeader,.toolsOverlay{display:none!important}
      [data-element="pageNavOverlay"],[data-element="pageNavigationOverlay"],.PageNavOverlay,.pageNavOverlay{display:none!important}
    `;
    const s = document.createElement('style'); s.textContent = killHeaderCSS; s.setAttribute('data-jsl','kill-header'); document.head.appendChild(s);
  });
})();
</script>


</body>
</html>
